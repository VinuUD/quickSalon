<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../../resources/css/allManagers.css" />
    <link rel="stylesheet" href="../..//resources/css/34.css" />
    <link rel="stylesheet" href="../..//resources/css/popup2AllManagers.css" />
    <link rel="stylesheet" href="../../resources/css/sideNavbar.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>

    <title>All Managers</title>
  </head>
  <body onresize="whenResizing()">
    <!-- //////////////////////////////////////// -->
    <!-- update manager -->
    <div id="pop3" class="popup3">
      <div class="popup23">
        <div class="top1">
          <i
            ><img
              onclick="hide3(), show()"
              src="../../resources/icons/cross.png"
              alt=""
          /></i>
          <b id="updateHeader">Update EMP001</b>
        </div>

        <div class="bar">
          <div><b>Emplyee ID </b> <input id="eID" type="text" disabled /></div>
          <div><b>Name </b> <input id="name" type="text" disabled /></div>
          <div>
            <b>Contact Num </b>
            <input id="cNum" type="text" value="0710157140" />
          </div>
          <div>
            <b>Salary </b> <input id="salary" type="text" value="1000000" />
          </div>

          <div>
            <b>Address </b> <input id="address" type="text" value="1000000" />
          </div>
          <div><b>NIC </b> <input id="nic" type="text" disabled /></div>
        </div>

        <div class="button3">
          <button
            id="updateManager"
            onclick="hide3(), show()"
            class="btn-success34"
          >
            Save
          </button>
        </div>
      </div>
    </div>
    <!-- ////////////////////////////////////////// -->
    <!-- remove manager -->
    <div id="pop1" class="popup1">
      <div class="popup21">
        <div class="top1">
          <i
            ><img
              onclick="hide2(), show()"
              src="../../resources/icons/cross.png"
              alt=""
          /></i>
          <b>Remove Manager</b>
        </div>
        <div class="pwd">
          <b> Enter password </b> <input id="password" type="password" />
        </div>

        <div class="button1">
          <button id="removeManager" onclick="hide2()" class="danger34">
            Remove
          </button>
        </div>
      </div>
    </div>

    <!-- ////////////////////////////////////////////// meka thama oya view button eka click krhma ena popup eka -->
    <div id="pop" class="popup">
      <div class="popup2">
        <div class="top1">
          <i
            ><img onclick="hide()" src="../../resources/icons/cross.png" alt=""
          /></i>
          <b id="empHeader">EMP001</b>
        </div>

        <div id="inDiv" class="bar">
          <div>
            <b>Employee Id </b>
            <input type="text" value="Shehan Sandeepa" disabled />
          </div>
          <div><b>Name </b> <input type="text" value="emp001" disabled /></div>
          <div>
            <b>Contact Num </b> <input type="text" value="emp001" disabled />
          </div>
          <div>
            <b>Salary </b> <input type="text" value="emp001" disabled />
          </div>
          <div>
            <b>NIC &nbsp;</b> <input type="text" value="emp001" disabled />
          </div>

          <div>
            <b>Address </b> <input type="text" value="1000000" disabled />
          </div>
        </div>
        <br />

        <div class="button">
          <button onclick="show2(), hide()" class="danger34">Remove</button>
          <button onclick="show3(),hide()" class="btn-danger34">Update</button>
        </div>
      </div>
    </div>
    <!-- ////////////////////////////////////////////////////////// -->

    <div id="mySidenav" class="sidenav"></div>
    <!-- sidebar -->

    <div id="main">
      <div class="back">
        <div id="navIcon" onclick="openNav()" class="navIcon">
          <img src="../../resources/icons/three.png" alt="Ooops" />
        </div>
        <button onclick="change()" class="btn34">
          <a style="text-decoration: none; color: white" href="ownerHome.html">
            home
          </a>
        </button>
      </div>

      <div class="topBar">
        <b>Managers</b>
      </div>
      <div class="mainDiv">
        <div class="tableDiv34">
          <table id="myTable" class="table34">
            <tr>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Contact Num</th>
              <th>NIC</th>
              <th>View</th>
            </tr>
            <tbody id="tbl"></tbody>
          </table>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      $("document").ready(function () {
        $("#eID").val("fuckddd");
        $.get("allManagers.html/view", function (response) {
          response.map(function (x) {
            $("#tbl").append(
              "<tr>" +
                "<td>" +
                x.empId +
                "</td>" +
                "<td>" +
                x.firstName +
                " " +
                x.lastName +
                "</td>" +
                "<td>" +
                x.contactNum +
                "</td>" +
                "<td>" +
                x.nic +
                "</td>" +
                "<td style='display:none'>" +
                x.salary +
                "</td>" +
                "<td style='display:none'>" +
                x.address +
                "</td>" +
                "<td>" +
                "<button title='view employee details' class = 'btn34' onclick = 'show(event)'>" +
                "<i class='fa fa-eye'>" +
                "</i>" +
                "</button>" +
                "</td>" +
                "</tr>"
            );

            console.log(x.nic);
          });

          $("#myTable").on("click", ".btn34", function () {
            var currentRow = $(this).closest("tr");

            var col1 = currentRow.find("td:eq(0)").text(); //emp
            var col2 = currentRow.find("td:eq(1)").text(); //fname  //lname
            var col3 = currentRow.find("td:eq(2)").text(); //c num
            var col4 = currentRow.find("td:eq(3)").text(); //nic
            var col5 = currentRow.find("td:eq(4)").text(); //sal
            var col6 = currentRow.find("td:eq(5)").text(); //address

            var data = col1 + "\n" + col2 + "\n" + col3 + "\n" + col4;
            $("#empHeader").html(col2);
            $("#updateHeader").html("Update " + col2);

            var inputFields = document
              .getElementById("inDiv")
              .getElementsByTagName("input");
            inputFields[0].value = col1;
            inputFields[1].value = col2;
            inputFields[2].value = col3;
            inputFields[3].value = col5;
            inputFields[4].value = col4;
            inputFields[5].value = col6;

            $("#eID").val(col1);
            $("#name").val(col2);
            $("#cNum").val(col3);
            $("#salary").val(col5);
            $("#nic").val(col4);
            $("#address").val(col6);

            // //////////////////////
            $("#updateManager").click(function () {
              var eID = $("#eID").val();
              var cNum = $("#cNum").val();
              var salary = $("#salary").val();
              var address = $("#address").val();
              console.log("helooooooooooooooooooooo");
              var dataObj = {
                eID: `${eID}`,
                cNum: `${cNum}`,
                salary: `${salary}`,
                address: `${address}`,
              };

              $.ajax({
                type: "GET",
                url: "allManagers.html/update",
                data: dataObj,
                success: function (response) {
                  console.log(response);
                  if (response == 1) {
                    alert("Manager Update Successfully!");
                    location.reload();
                  } else if (response == 0) {
                    alert("Manager update Unsuccessfully!! please try again !");
                    location.reload();
                  }
                },
              });

              // document.getElementById("myForm").reset();
            });
            // //////////////////////////

            // //////////////////////
            $("#removeManager").click(function () {
              var password = $("#password").val();
              console.log(password);
              console.log(col1);
              $.ajax({
                type: "GET",
                url: "http://localhost:8080/quickSalon_war_exploded/remove",
                data: { id: `${col1}`, password: `${password}` },
                success: function (response) {
                  console.log(response);
                  if (response == 1) {
                    alert("Manager Removed Successfully!");
                    location.reload();
                  } else if (response == 0) {
                    alert("Manager Remove Unsuccessfully!! please try again !");
                    location.reload();
                  } else if (response == 4) {
                    alert("Password does not match! Try again!");
                    location.reload();
                  }
                },
              });

              // document.getElementById("myForm").reset();
            });
            // //////////////////////////
          });
        });
      });
    </script>

    <script src="../../resources/javascript/allManagers.js"></script>

    <script src="../../resources/javascript/side_navbar.js"></script>
  </body>
</html>
